Phase : Phase 3 — 데이터 아키텍처 개선
Status : 진행 중 (Task 3-1, 3-2, 3-3 완료)
LastUpdate : 2026-02-08
Branch : refactor/phase-3-data
RecentWork : Task 3-2 에러 처리 체계화 + Task 3-3 emptyTrash batch write 완료
  - firestoreCall(operation, errorMessage) 래퍼 함수 추가 (에러 시 console.error + toast + re-throw)
  - initDBLegacy, initDBNewStructure, saveDBLegacy, saveDBNewStructure, savePageToCollection, loadPageFull에 firestoreCall 적용
  - 비핵심 작업(logLoginAttempt, logDeleteAction)에 try-catch + console.warn 적용 (사용자 toast 없음)
  - updateStorageUsage에서 누락된 saveDB() return 추가
  - batchDeletePages 헬퍼 함수 추가 (500개 제한 분할 처리)
  - emptyTrash, permanentDelete에서 USE_NEW_STRUCTURE일 때 batch write 사용
  - firestoreCall 테스트 5개 + batchDeletePages 테스트 4개 추가 (총 75 tests pass)
  - Vite 빌드 정상 확인
MainWork :
  - [x] Task 3-1: Firestore 컬렉션 정규화 (마이그레이션 스크립트 + 호환 레이어)
  - [x] Task 3-2: 에러 처리 체계화
  - [x] Task 3-3: emptyTrash 일괄 처리 (batch write)
ResolvedWork :
  - Task 3-1: 마이그레이션 스크립트(migrate-pages.js), 검증 스크립트(verify-migration.js), 호환 레이어(USE_NEW_STRUCTURE), Firestore rules 업데이트
  - Task 3-2: firestoreCall 래퍼, 모든 Firestore 호출에 일관된 에러 처리, 비핵심 로깅에 silent catch
  - Task 3-3: batchDeletePages 헬퍼 (500개 분할), emptyTrash/permanentDelete batch write 적용
MainIssues : (없음)
ResolvedIssues :
  - Firestore 호출에 에러 처리 없음 → firestoreCall 래퍼로 일괄 해결
  - emptyTrash 순차 삭제 (비효율) → Firestore batch write로 해결
  - updateStorageUsage에서 saveDB() 반환값 누락 → return 추가
RelatedPhases : Phase 1 (완료), Phase 2 (완료), 전체 계획 docs/plans/2026-02-08-full-refactor.md 참고
